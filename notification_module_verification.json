{
  "auth": "Bearer JWT required. Header: Authorization: Bearer <access_token>. Body user_id must match authenticated user.",
  "device_token_for_testing": "dGVzdF9mY21fZHVtbXlfZGV2aWNlX3Rva2VuXzEyMzQ1Njc4OTBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eg",
  "dummy_device_token": "dGVzdF9mY21fZHVtbXlfZGV2aWNlX3Rva2VuXzEyMzQ1Njc4OTBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eg",
  "test_payloads": {
    "POST /api/notifications/send": {
      "user_id": 1,
      "title": "Order Shipped",
      "message": "Your order #12345 has been shipped.",
      "type": "info"
    },
    "GET /api/notifications": "?limit=20&unread_only=false",
    "GET /api/notifications/unread-count": "(no body)",
    "PUT /api/notifications/{id}/read": "path: e.g. /api/notifications/1/read, no body"
  },
  "verification_checklist": [
    {"id": "send_notification", "method": "POST", "path": "/api/notifications/send", "expect": 200},
    {"id": "list_notifications", "method": "GET", "path": "/api/notifications", "expect": 200},
    {"id": "list_unread", "method": "GET", "path": "/api/notifications?unread_only=true&limit=10", "expect": 200},
    {"id": "unread_count", "method": "GET", "path": "/api/notifications/unread-count", "expect": 200},
    {"id": "mark_read", "method": "PUT", "path": "/api/notifications/1/read", "expect": 200},
    {"id": "mark_read_404", "method": "PUT", "path": "/api/notifications/99999/read", "expect": 404},
    {"id": "no_auth", "method": "GET", "path": "/api/notifications", "no_auth_header": true, "expect": 401}
  ],
  "backend_events_that_trigger_notifications": [
    {
      "event": "Payment failed (Razorpay webhook)",
      "trigger": "POST /orders/webhook with Razorpay event payment.failed (valid signature, order not already confirmed)",
      "source": "Order_router.razorpay_webhook",
      "expected_notification": {"title": "Payment failed", "message": "Payment for order {order_number} could not be completed. You can retry payment for this order.", "type": "warning"},
      "how_to_verify": "After sending webhook, GET /api/notifications as order owner; latest notification should match."
    },
    {
      "event": "Payment failed (verify failure)",
      "trigger": "Payment verification fails (e.g. invalid Razorpay signature when frontend confirms payment)",
      "source": "Order_crud.verify_payment_and_confirm_order",
      "expected_notification": {"title": "Payment failed", "message": "Payment for order {order_number} could not be completed. You can retry payment for this order.", "type": "warning"},
      "how_to_verify": "Trigger failed verification for an order; GET /api/notifications as that user; latest should match."
    },
    {
      "event": "Order confirmed",
      "trigger": "POST /orders/webhook with Razorpay event payment.captured or order.paid",
      "source": "Order_crud.confirm_order_from_webhook",
      "expected_notification": {"title": "Order confirmed", "message": "Your order {order_number} has been confirmed.", "type": "success"},
      "how_to_verify": "After webhook confirms order, GET /api/notifications as order owner; latest should match."
    },
    {
      "event": "Order status updated to notifiable status",
      "trigger": "PUT /orders/{order_number}/status with status one of: scheduled, schedule_confirmed_by_lab, sample_collected, sample_received_by_lab, testing_in_progress, report_ready, completed",
      "source": "Order_router.update_order_status_api -> Order_crud.update_order_status",
      "expected_notifications": [
        {"status": "completed", "title": "Report ready", "message": "Your lab report for order {order_number} is ready.", "type": "success"},
        {"status": "scheduled", "title": "Sample scheduled", "message": "Your sample collection for order {order_number} has been scheduled.", "type": "info"},
        {"status": "schedule_confirmed_by_lab", "title": "Schedule confirmed", "message": "Lab has confirmed the schedule for order {order_number}.", "type": "info"},
        {"status": "sample_collected", "title": "Sample collected", "message": "Sample for order {order_number} has been collected.", "type": "info"},
        {"status": "sample_received_by_lab", "title": "Sample at lab", "message": "Lab has received the sample for order {order_number}.", "type": "info"},
        {"status": "testing_in_progress", "title": "Testing in progress", "message": "Testing in progress for order {order_number}.", "type": "info"},
        {"status": "report_ready", "title": "Report ready", "message": "Your lab report for order {order_number} is ready.", "type": "success"}
      ],
      "how_to_verify": "PUT /orders/{order_number}/status with one status above (order confirmed, payment completed). GET /api/notifications as order owner; latest should match that status."
    }
  ]
}
